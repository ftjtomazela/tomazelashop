<div class="input-group" id="group-gps" onclick="pedirPermissaoGPS()" style="cursor:pointer; border: 1px solid #3498db;">
    <div class="dot-origem"></div>
    <input type="text" id="origemInput" value="Clique para autorizar GPS üìç" disabled>
</div>
<script>
    const PRECO_FIXO = "R$ 7,00";
    let minhaLocalizacao = null; // Guardar√° lat e lng do passageiro

    // Inicializa o mapa focado em Conchas por padr√£o
    const map = L.map('map').setView([-23.0134, -48.0089], 15);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    // Fun√ß√£o para pedir autoriza√ß√£o do GPS
    function pedirPermissaoGPS() {
        if (!navigator.geolocation) {
            alert("Seu navegador n√£o suporta GPS.");
            return;
        }

        // Mostra o carregamento no input
        document.getElementById('origemInput').value = "Localizando...";

        navigator.geolocation.getCurrentPosition((posicao) => {
            const lat = posicao.coords.latitude;
            const lng = posicao.coords.longitude;
            minhaLocalizacao = { lat, lng };

            // Centraliza o mapa na pessoa e coloca o marcador azul
            map.setView([lat, lng], 17);
            
            // Remove marcador antigo se existir e cria um novo
            if (window.markerPassageiro) map.removeLayer(window.markerPassageiro);
            window.markerPassageiro = L.circleMarker([lat, lng], {
                radius: 10,
                color: '#fff',
                fillColor: '#3498db',
                fillOpacity: 1,
                weight: 3
            }).addTo(map).bindPopup("Voc√™ est√° aqui").openPopup();

            // Atualiza o texto do input
            document.getElementById('origemInput').value = "Localiza√ß√£o confirmada ‚úÖ";
            document.getElementById('group-gps').style.borderColor = "#2ecc71";

        }, (erro) => {
            alert("Erro ao acessar GPS. Por favor, autorize nas configura√ß√µes.");
            document.getElementById('origemInput').value = "GPS n√£o autorizado ‚ùå";
        }, {
            enableHighAccuracy: true
        });
    }

    // Ajuste na fun√ß√£o de enviar pedido para incluir o GPS no Firebase
    function enviarPedido() {
        const dest = document.getElementById('destinoInput').value;
        if (!minhaLocalizacao) return alert("Por favor, autorize o GPS primeiro!");
        if (!dest) return alert("Digite o destino!");

        document.getElementById('tela-pedido').style.display = 'none';
        document.getElementById('tela-aguarde').style.display = 'block';

        db.collection("corridas").add({
            passageiro: "Cliente Conchas",
            origem: {
                lat: minhaLocalizacao.lat,
                lng: minhaLocalizacao.lng
            },
            destino: dest,
            status: "pendente",
            valor: PRECO_FIXO,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(doc => {
            monitorarStatus(doc.id);
        });
    }
    
    // ... manter as outras fun√ß√µes (monitorarStatus e cancelar) ...
</script>
